<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–æ—Ç–æ ‚Äú–î–æ / –ü–æ—Å–ª–µ‚Äù</title>
  <!-- –®—Ä–∏—Ñ—Ç—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Montserrat:wght@500;600&family=Roboto+Slab:wght@500&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 20px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 900px;
      background: #020617;
      border-radius: 24px;
      padding: 24px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.7);
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    h1 {
      margin-top: 0;
      margin-bottom: 12px;
      font-weight: 700;
      font-size: 24px;
    }

    p {
      margin-top: 0;
      margin-bottom: 16px;
      color: #9ca3af;
      font-size: 14px;
    }

    .inputs {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .settings {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .input-block {
      background: #020617;
      border-radius: 16px;
      padding: 12px 14px;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .input-block label {
      display: block;
      font-size: 13px;
      margin-bottom: 8px;
      color: #e5e7eb;
    }

    input[type="file"] {
      width: 100%;
      font-size: 13px;
      color: #e5e7eb;
    }

    input[type="file"]::file-selector-button {
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      margin-right: 10px;
      background: #2563eb;
      color: white;
      cursor: pointer;
      font-size: 13px;
    }

    select,
    input[type="color"] {
      width: 100%;
      font-size: 13px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 6px 10px;
      background: #020617;
      color: #e5e7eb;
      outline: none;
    }

    input[type="color"] {
      padding: 0;
      height: 32px;
      border-radius: 16px;
      background: transparent;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
    }

    button,
    .secondary-btn {
      border-radius: 999px;
      padding: 10px 18px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s ease;
    }

    button.primary {
      background: linear-gradient(135deg, #2563eb, #7c3aed);
      color: white;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.5);
    }

    button.primary:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 4px 10px rgba(37, 99, 235, 0.4);
    }

    .secondary-btn {
      background: transparent;
      color: #cbd5f5;
      border: 1px solid rgba(148, 163, 184, 0.5);
      text-decoration: none;
    }

    .secondary-btn:active {
      transform: translateY(1px) scale(0.99);
    }

    .status {
      font-size: 13px;
      color: #9ca3af;
      min-height: 18px;
      margin-bottom: 10px;
    }

    .preview-wrapper {
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: radial-gradient(circle at top, rgba(148,163,184,0.25), transparent 60%);
      padding: 12px;
      max-height: 520px;
      overflow: auto;
    }

    .preview-wrapper::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    .preview-wrapper::-webkit-scrollbar-track {
      background: transparent;
    }

    .preview-wrapper::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.6);
      border-radius: 999px;
    }

    canvas {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
      border-radius: 18px;
      background: #020617;
      box-shadow: 0 18px 35px rgba(0,0,0,0.6);
    }

    .hint {
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
    }

    @media (max-width: 600px) {
      .app {
        padding: 16px;
        border-radius: 18px;
      }
      h1 {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–æ—Ç–æ ‚Äú–î–æ / –ü–æ—Å–ª–µ‚Äù</h1>
    <p>–ó–∞–≥—Ä—É–∑–∏ –¥–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: —Å–ª–µ–≤–∞ –±—É–¥–µ—Ç ¬´–î–æ¬ª, —Å–ø—Ä–∞–≤–∞ ‚Äî ¬´–ü–æ—Å–ª–µ¬ª. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–∏—Ç –∏—Ö, –¥–æ–±–∞–≤–∏—Ç –ø–æ–¥–ø–∏—Å–∏ –∏ –ø–æ–∑–≤–æ–ª–∏—Ç —Å–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</p>

    <div class="inputs">
      <div class="input-block">
        <label for="beforeInput">–§–æ—Ç–æ ‚Äú–î–æ‚Äù (–ª–µ–≤–æ–µ)</label>
        <input type="file" id="beforeInput" accept="image/*">
        <div class="hint">–í—ã–±–µ—Ä–∏ —Ñ–æ—Ç–æ –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π</div>
      </div>
      <div class="input-block">
        <label for="afterInput">–§–æ—Ç–æ ‚Äú–ü–æ—Å–ª–µ‚Äù (–ø—Ä–∞–≤–æ–µ)</label>
        <input type="file" id="afterInput" accept="image/*">
        <div class="hint">–í—ã–±–µ—Ä–∏ —Ñ–æ—Ç–æ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π</div>
      </div>
    </div>

    <div class="settings">
      <div class="input-block">
        <label for="labelPosition">–ü–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏</label>
        <select id="labelPosition">
          <option value="top">–°–≤–µ—Ä—Ö—É</option>
          <option value="bottom">–°–Ω–∏–∑—É</option>
        </select>
      </div>
      <div class="input-block">
        <label for="labelColor">–¶–≤–µ—Ç –ø–æ–¥–ø–∏—Å–∏</label>
        <input type="color" id="labelColor" value="#ffffff">
      </div>
      <div class="input-block">
        <label for="labelFont">–®—Ä–∏—Ñ—Ç –ø–æ–¥–ø–∏—Å–∏</label>
        <select id="labelFont">
          <option value="'Playfair Display', serif">Playfair Display</option>
          <option value="'Montserrat', sans-serif">Montserrat</option>
          <option value="'Roboto Slab', serif">Roboto Slab</option>
        </select>
      </div>
    </div>

    <div class="buttons">
      <button class="primary" id="generateBtn">
        üîÑ –û–±—ä–µ–¥–∏–Ω–∏—Ç—å ‚Äú–î–æ / –ü–æ—Å–ª–µ‚Äù
      </button>
      <a id="downloadLink" class="secondary-btn" href="#" download="do-posle.png" style="display:none;">
        ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      </a>
    </div>

    <div class="status" id="statusText"></div>

    <div class="preview-wrapper">
      <canvas id="resultCanvas"></canvas>
    </div>
  </div>

  <script>
    const beforeInput = document.getElementById('beforeInput');
    const afterInput = document.getElementById('afterInput');
    const generateBtn = document.getElementById('generateBtn');
    const statusText = document.getElementById('statusText');
    const canvas = document.getElementById('resultCanvas');
    const ctx = canvas.getContext('2d');
    const downloadLink = document.getElementById('downloadLink');

    const labelPositionEl = document.getElementById('labelPosition');
    const labelColorEl = document.getElementById('labelColor');
    const labelFontEl = document.getElementById('labelFont');

    function loadImageFromFile(file) {
      return new Promise((resolve, reject) => {
        if (!file) {
          reject(new Error('–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω'));
          return;
        }
        const reader = new FileReader();
        reader.onload = () => {
          const img = new Image();
          img.onload = () => resolve(img);
          img.onerror = () => reject(new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏'));
          img.src = reader.result;
        };
        reader.onerror = () => reject(new Error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞'));
        reader.readAsDataURL(file);
      });
    }

    async function generate() {
      statusText.textContent = '';
      downloadLink.style.display = 'none';

      const beforeFile = beforeInput.files[0];
      const afterFile = afterInput.files[0];

      if (!beforeFile || !afterFile) {
        statusText.textContent = '–ó–∞–≥—Ä—É–∑–∏ –æ–±–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ‚Äú–î–æ‚Äù –∏ ‚Äú–ü–æ—Å–ª–µ‚Äù.';
        return;
      }

      try {
        statusText.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...';

        const [beforeImg, afterImg] = await Promise.all([
          loadImageFromFile(beforeFile),
          loadImageFromFile(afterFile)
        ]);

        const targetHeight = Math.min(beforeImg.height, afterImg.height, 900);
        const scaleBefore = targetHeight / beforeImg.height;
        const scaleAfter = targetHeight / afterImg.height;

        const beforeWidth = Math.round(beforeImg.width * scaleBefore);
        const afterWidth = Math.round(afterImg.width * scaleAfter);

        const totalWidth = beforeWidth + afterWidth;

        canvas.width = totalWidth;
        canvas.height = targetHeight;

        // —Ñ–æ–Ω
        ctx.fillStyle = "#020617";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // –ª–µ–≤–æ–µ –∏ –ø—Ä–∞–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        ctx.drawImage(beforeImg, 0, 0, beforeWidth, targetHeight);
        ctx.drawImage(afterImg, beforeWidth, 0, afterWidth, targetHeight);

        // –±–µ–ª–∞—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∞ –º–µ–∂–¥—É —Ñ–æ—Ç–æ
        const dividerWidth = Math.max(2, Math.round(totalWidth * 0.002));
        ctx.fillStyle = 'rgba(255,255,255,0.75)';
        ctx.fillRect(beforeWidth - dividerWidth / 2, 0, dividerWidth, targetHeight);

        // –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–∫—Å—Ç–∞
        const fontSize = Math.max(24, Math.round(targetHeight * 0.08));
        const padding = Math.round(fontSize * 0.6);
        const selectedFont = labelFontEl.value;

        ctx.font = fontSize + 'px ' + selectedFont;
        ctx.textBaseline = 'top';

        function drawLabel(text, x, align = 'left') {
          ctx.textAlign = align;

          const metrics = ctx.measureText(text);
          const textWidth = metrics.width;
          const rectHeight = fontSize * 1.6;

          let rectX = x;
          if (align === 'center') rectX = x - textWidth / 2 - padding / 2;
          if (align === 'right') rectX = x - textWidth - padding;

          const rectWidth = textWidth + padding * 1.3;
          const rectY = labelPositionEl.value === 'bottom'
            ? canvas.height - rectHeight - padding
            : padding;

          // –ø–æ–¥–ª–æ–∂–∫–∞
          ctx.fillStyle = 'rgba(0,0,0,0.55)';
          if (typeof ctx.roundRect === 'function') {
            ctx.beginPath();
            ctx.roundRect(rectX, rectY, rectWidth, rectHeight, 12);
            ctx.fill();
          } else {
            ctx.fillRect(rectX, rectY, rectWidth, rectHeight);
          }

          // —Ç–µ–∫—Å—Ç
          ctx.fillStyle = labelColorEl.value || '#ffffff';
          const textX =
            align === 'left' ? rectX + padding * 0.6 :
            align === 'right' ? rectX + rectWidth - padding * 0.6 :
            x;
          const textY = rectY + (rectHeight - fontSize) / 2 - 1;

          ctx.fillText(text, textX, textY);
        }

        drawLabel('–î–æ', padding, 'left');
        drawLabel('–ü–æ—Å–ª–µ', totalWidth - padding, 'right');

        const dataURL = canvas.toDataURL('image/png');
        downloadLink.href = dataURL;
        downloadLink.style.display = 'inline-flex';

        statusText.textContent = '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ. –ú–æ–∂–µ—à—å —Å–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.';
      } catch (err) {
        console.error(err);
        statusText.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª—ã –∏ –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.';
      }
    }

    generateBtn.addEventListener('click', generate);
  </script>
</body>
</html>
